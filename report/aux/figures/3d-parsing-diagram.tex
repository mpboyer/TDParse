\def\shear#1#2{
	\begin{scope}[cm={1, 0, #1, (0, 0)}]
		#2
	\end{scope}
}
\def\rt#1{\rotatebox{180}{#1}}

\newcommand{\wool}[1][]{\draw[decorate, decoration={random steps, amplitude=1pt, segment length=1pt}, #1]}

\colorlet{cif}{blue}
\colorlet{ceve}{red}
\colorlet{cpass}{yulm}
\colorlet{crain}{vulm}
\colorlet{cevepass}{ceve!50!cpass}
\colorlet{cifevp}{cevepass!50!cif}
\colorlet{cend}{cifevp!50!crain}

\def\theopac{.2}

\tikzset{
	pics/pelote/.style args={#1}{
			code = {
					\coordinate (-center) at (0,0);
					\draw (-center) ellipse (1cm and .7cm);
					\foreach \i in {1,...,25}{
							\pgfmathsetmacro{\gdaxe}{.1 + .9 * \i/25}
							\pgfmathsetmacro{\ptaxe}{.1 + .6 * \i/25}
							\draw[#1] (-center) ellipse (\gdaxe cm and \ptaxe cm);
						}
					\draw ($(-center) + (0, 0)$) ellipse (.1cm and .1cm);
					\coordinate (-north) at ($(-center) + (0, .7cm)$);
					\coordinate (-south) at ($(-center) + (0, -.7cm)$);
					\coordinate (-west) at ($(-center) + (-1cm, 0)$);
					\coordinate (-east) at ($(-center) + (1cm, 0)$);
				}
		}
}

\tikzset{%
main3D/.pic={%
\shear{.2, .7}{\pic[transform shape] (w1) at (0, 0) {pelote=cif};}
\shear{.2, .8}{\pic[transform shape] (w2) at ($(w1-east) + (1.5cm, .3)$) {pelote=ceve};}
\shear{.2, 1}{\pic[transform shape] (w3) at ($(w2-east) + (1.5cm, -.2)$) {pelote=cpass};}
\shear{.2, .9}{\pic[transform shape] (w4) at ($(w3-east) + (1.5cm, -.1)$) {pelote=crain};}
\node[anchor=south] (w2-word) at (w2-north) {\rt{\vphantom{pb}\textbf{everyone}}};
\path let
\p1 = (w1-north),
\p2 = (w2-word),
\p3 = (w3-north),
\p4 = (w4-north)
in
coordinate[label=center:\vphantom{pb}\textbf{if}] (w1-word) at (\x1, \y2)
coordinate[label=center:\vphantom{pb}\textbf{passed}] (w3-word) at (\x3, \y2)
coordinate[label=center:\vphantom{pb}\textbf{it rained}] (w4-word) at (\x4, \y2);
\path let
\p1 = ($(w1-word.north) + (0, .7)$),
\p2 = (w2-word),
\p3 = (w3-word),
\p4 = (w4-word)
in
coordinate[label=center:$\vphantom{pb}\lambda c. \forall x. c\, x$] (w2-denot) at (\x2, \y1)
coordinate[label=center:$\vphantom{pb}\w{pass}$] (w3-denot) at (\x3, \y1)
coordinate[label=center:$\vphantom{pb}\w{rain}$] (w4-denot) at (\x4, \y1)
;
\coordinate (base) at (0, -2);
%
\wool[cif] let \p1 = (base),	\p2 = (w1-south) in	(\x2, \y2) -- (\x2, \y1) coordinate[black, label=right:$\t \to \t \to \t$] (if) ;
\wool[ceve] let \p1 = (base),	\p2 = ($(w2-south) + (+.3, .02)$) in	(\x2, \y2) -- (\x2, \y1) coordinate[black, label=left:$\f{C}$] (everyone-t);
\wool[ceve] let \p1 = (base),	\p2 = ($(w2-south) + (-.2, .011)$) in	(\x2, \y2) -- (\x2, \y1) coordinate[black, label=right:$\e$] (everyone-f);
\wool[cpass] let \p1 = (base),	\p2 = (w3-south) in	(\x2, \y2) -- (\x2, \y1) coordinate[black, label=left:$\e \to \t$] (passed);
\wool[crain] let \p1 = (base),	\p2 = (w4-south) in	(\x2, \y2) -- (\x2, \y1) coordinate[black, label=left:$\t$] (rain);
%
\wool[cif, opacity=\theopac] (if) -- +(0, -9.5) coordinate (ifp2);
%
%
%
\coordinate (evef1) at ($(everyone-f) + (-.5, -2)$);
\coordinate (evet1) at ($(everyone-t) + (-1, -2.5)$);
\path let
\p1 = (evef1),
\p2 = ($(passed) + (0, -3.5)$)
in coordinate (pass1) at (\x1, \y2);
\draw[opacity=\theopac, ceve] (everyone-f) -- ++(0, -1.5) to[out=-90, in=0] (evef1) -- ++(-3, 0) coordinate (eveftmp) (everyone-t) -- ++(0, -1.5) to[out=-90, in=0] (evet1) -- ++(-3, 0) coordinate (evettmp);
\draw[opacity=1, ceve] (evettmp) -- +(-1.5, 0) coordinate (evet2) (eveftmp) -- +(-1.5, 0) coordinate (evef2);
\draw[opacity=\theopac, cpass] (passed) -- ++(0, -1.5) to[out=-90, in=0] (pass1) -- ++(-3, 0) coordinate (passtmp);
\draw[opacity=1, cpass] (passtmp) -- +(-.5, 0) coordinate (pass2);
\coordinate (evef3) at ($(evef2) + (-2, -2)$);
\coordinate (evet3) at ($(evet2) + (-1.5, -1.5)$);
\coordinate (pass3) at ($(pass2) + (-.5, -.5)$);
\draw[ceve] (evef2) to[out=180, in=90] (evef3) (evet2) to[out=180, in=90] (evet3);
\draw[cpass] (pass2) to[out=180, in=90] (pass3);
%
\node[circle, draw=black] (eve-pass-fmap) at ($($(evet3)!.5!(pass3)$) + (0, -1.5)$) {\rt{$\combML_{\f{C}}$}};
\draw[ceve] (evef3) to[out=-90, in=160] (eve-pass-fmap);
\draw[ceve] (evet3) to[out=-90, in=160] (eve-pass-fmap);
\draw[cpass] (pass3) to[out=-90, in=20] (eve-pass-fmap);
\node[circle, draw=black] (eve-pass-app) at ($(eve-pass-fmap) + (0, -2)$) {\rt{$<$}};
\draw[ceve] (eve-pass-fmap) to[out=200, in=160] (eve-pass-app);
\draw[cpass] (eve-pass-fmap) to[out=-20, in=20] (eve-pass-app);
\node[anchor=west] at (eve-pass-app.east) {\rt{\vphantom{pb}$\e$}};
\node[anchor=east] at (eve-pass-app.west) {                 \rt{\vphantom{pb}$\e \to \t$}};
\wool[cevepass] (eve-pass-app) to[out=-90, in=180] ++(1, -1) -- ++(1, 0) coordinate (evpaptmp2);
\wool[cevepass, opacity=\theopac] (evpaptmp2) -- ++(3.5,0) to[out=0, in=90] +(1, -1) coordinate[label=above right:$\t$] (eve-pass-t);
\draw[black] let
\p1 = ($(evpaptmp2) + (0, -.5)$),
\p2 = ($(evef2) + (-3.5, .5)$)
in
(\x1, \y1) rectangle (\x2, \y2);
%
\wool[cevepass] let
\p1 = (evpaptmp2),
\p2 = (eve-pass-fmap.east) in
(eve-pass-fmap.east) -- (\x1, \y2) coordinate (evpaptmp);
\wool[cevepass, opacity=\theopac] (evpaptmp) -- ++(4, 0) to[out=0, in=90] ++(1, -1) -- +(0, -3) coordinate[label=above left:$\f{C}$] (eve-pass-f);
%
%
%
%
\draw[opacity=\theopac, cif] let
\p1 = (evpaptmp2),
\p2 = ($(ifp2) + (0, -1)$) in
(ifp2) to[out=-90, in=0] ++(-1, -1) -- (\x1, \y2) coordinate (if2) ;
\draw[opacity=\theopac, cevepass] let
\p1 = (if2),
\p2 = ($(eve-pass-t) + (0, -2)$),
\p3 = ($(eve-pass-f) + (0, -2.5)$) in
(eve-pass-t) -- ++ (0, -1) to[out=-90, in=0] ++(-1, -1) -- (\x1, \y2) coordinate (eve-pass-t2)
(eve-pass-f) -- ++ (0, -1) to[out=-90, in=0] ++(-1.5, -1.5) -- (\x1, \y3) coordinate (eve-pass-f2);
%
\draw[cif] (if2) -- ++(-2, 0) to[out=180, in=90] ++(-1, -1) -- +(0, -1.5) coordinate (if3);
\draw[cevepass] (eve-pass-t2) to[out=180, in=90] +(-1, -1) coordinate (eve-pass-t3);
\draw[cevepass] (eve-pass-f2) to[out=180, in=90] +(-.5, -.5) coordinate (eve-pass-f3);
%
\node[circle, draw=black] (if-evp-dn) at ($($(if3)!.5!(eve-pass-t3)$) + (0, -1)$) {\rt{$\combDN_{\Downarrow}$}};
\draw[cevepass] (eve-pass-f3) to[out=-90, in=20] (if-evp-dn) (eve-pass-t3) to[out=-90, in=20] (if-evp-dn);
\draw[cif] (if3) to[out=-90, in=160] (if-evp-dn);
\node[circle, draw=black] (if-evp-app) at ($(if-evp-dn) + (0, -2)$) {\rt{$>$}};
\draw[cif] (if-evp-dn) to[out=200, in=160] (if-evp-app);
\draw[cevepass] (if-evp-dn) to[out=-20, in=20] (if-evp-app);
\node[anchor=west] at (if-evp-app.east) {\rt{\vphantom{pb}$\t$}};
\node[anchor=east] at (if-evp-app.west) {\rt{\vphantom{pb}$\t\to\t\to\t$}};
%
\wool[cifevp] (if-evp-app) to[out=-90, in=180] ++(1, -1) -- ++(1, 0) coordinate (ifevptmp);
\wool[cifevp, opacity=\theopac] (ifevptmp) -- ++(3.5,0) to[out=0, in=90] +(1, -1) coordinate[label=left:$\t \to \t$] (if-evp-t);
\draw[black] let
\p1 = ($(ifevptmp) + (0, -.5)$),
\p2 = ($(if2) + (-5, .5)$)
in
(\x1, \y1) rectangle (\x2, \y2);
\wool[crain, opacity=\theopac] let \p1 = (if-evp-t), \p2 = (rain) in (rain) -- (\x2, \y1) coordinate (rainp2);
%
%
%
%
\draw[opacity=\theopac, cifevp] (if-evp-t) to[out=-90, in=0] ++(-1, -1) -- +(-3.5, 0) coordinate (if-evp-t2);
\draw[opacity=\theopac, crain] let
\p1 = (if-evp-t2),
\p2 = ($(rainp2) + (0, -2)$) in
(rainp2) to[out=-90, in=0] ++ (-2, -2) -- (\x1, \y2) coordinate(rain2);
\draw[cifevp] (if-evp-t2) -- ++(-2, 0) to[out=180, in=90] ++(-1, -1) -- +(0, -1) coordinate (if-evp-t3);
\draw[crain] (rain2) to[out=180, in=90] +(-1, -1) coordinate (rain3);
\node[circle, draw=black] (ifrain) at ($($(if-evp-t3)!.5!(rain3)$) + (0, -1)$) {\rt{$>$}};
\draw[cifevp] (if-evp-t3) to[out=-90, in=160] (ifrain);
\draw[cif] (rain3) to[out=-90, in=20] (ifrain);
\wool[cend] (ifrain) to[out=-90, in=180] ++(1, -1) -- ++(1, 0) coordinate (ifrain2);
\draw[black] let
\p1 = ($(ifrain2) + (0, -.5)$),
\p2 = ($(if-evp-t2) + (-5, .5)$)
in
(\x1, \y1) rectangle (\x2, \y2);
\wool[opacity=\theopac, cend] (ifrain2) -- ++(3.5, 0) to[out=0, in=90] ++(1, -1) to[out=-90, in=0] ++(-1, -1) -- ++(-3.5, 0) coordinate (sentence-t);
\wool[cend] (sentence-t) -- ++ (-1, 0) to[out=180, in=90] ++(-1, -1) coordinate[label=below right:$\t$] (end-before) -- +(0, -2) coordinate (end);
\draw[black] let \p1 = (sentence-t), \p2 = ($(end) + (0, 0)$) in ($(sentence-t) + (-5, .5)$) rectangle (\x1, \y2);
\draw[->] let
\p1 = ($(w4-east) + (1, -.2)$),
\p2 = ($(end) + (0, 1)$),
\p3 = ($(\x1, \y1)!.5!(\x1, \y2)$)
in (\x1, \y1) -- (\x1, \y2)
node[anchor=west] at (\x3, \y3) {\rotatebox{-90}{Direction of Reduction}};
}
}

\resizebox{\textwidth}{!}{%
	\rotatebox{180}{%
		\begin{tikzpicture}
			\pic[yscale=.6, every label/.style={rotate=180}] at (0, 0) {main3D};
		\end{tikzpicture}
	}
}

